<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UML Diagram - MDS Formatter Lifecycle with Specialized Agents</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 2000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .uml-container {
            padding: 40px;
            background: #f8f9fa;
            overflow-x: auto;
        }

        .uml-diagram {
            min-width: 2000px;
            height: 1800px;
            position: relative;
            background: white;
            border: 2px solid #34495e;
            border-radius: 10px;
            margin: 0 auto;
        }

        /* Actors */
        .actor {
            position: absolute;
            text-align: center;
            font-weight: bold;
            color: #2c3e50;
        }

        .actor-icon {
            width: 80px;
            height: 100px;
            background: #3498db;
            border-radius: 40px 40px 0 0;
            margin: 0 auto 10px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .actor-icon:hover {
            transform: scale(1.1);
            background: #e74c3c;
        }

        .actor-icon.field-mapping {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            font-size: 2em;
        }

        .actor-icon.field-mapping:hover {
            background: linear-gradient(135deg, #8e44ad, #732d91);
        }

        .actor-icon.code-generator {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }

        .actor-icon.code-generator:hover {
            background: linear-gradient(135deg, #d35400, #ba4a00);
        }

        .actor-icon.code-validator {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .actor-icon.code-validator:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
        }

        .actor-icon.issue-resolver {
            background: linear-gradient(135deg, #e67e22, #f39c12);
        }

        .actor-icon.issue-resolver:hover {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .actor-name {
            font-size: 0.9em;
            max-width: 140px;
            word-wrap: break-word;
            line-height: 1.2;
        }

        /* Lifelines */
        .lifeline {
            position: absolute;
            width: 3px;
            background: linear-gradient(to bottom, #bdc3c7, #95a5a6);
            top: 140px;
            bottom: 50px;
        }

        /* Activations */
        .activation {
            position: absolute;
            width: 18px;
            background: #3498db;
            border: 2px solid #2980b9;
            left: -7px;
            border-radius: 3px;
        }

        .activation.field-mapping {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border-color: #732d91;
        }

        .activation.code-generator {
            background: linear-gradient(135deg, #e67e22, #d35400);
            border-color: #ba4a00;
        }

        .activation.code-validator {
            background: linear-gradient(135deg, #27ae60, #229954);
            border-color: #1e8449;
        }

        .activation.issue-resolver {
            background: linear-gradient(135deg, #e67e22, #f39c12);
            border-color: #d68910;
        }

        /* Messages */
        .message {
            position: absolute;
            height: 4px;
            background: #e74c3c;
            display: flex;
            align-items: center;
            border-radius: 2px;
            z-index: 5;
        }

        .message.field-mapping {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
        }

        .message.code-generator {
            background: linear-gradient(to right, #e67e22, #d35400);
        }

        .message.code-validator {
            background: linear-gradient(to right, #27ae60, #229954);
        }

        .message.issue-resolver {
            background: linear-gradient(to right, #e67e22, #f39c12);
        }

        .message::after {
            content: '';
            position: absolute;
            right: -12px;
            top: -6px;
            width: 0;
            height: 0;
            border-left: 12px solid #e74c3c;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }

        .message.field-mapping::after {
            border-left-color: #8e44ad;
        }

        .message.code-generator::after {
            border-left-color: #d35400;
        }

        .message.code-validator::after {
            border-left-color: #229954;
        }

        .message.issue-resolver::after {
            border-left-color: #f39c12;
        }

        .message-label {
            position: absolute;
            top: -35px;
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            color: #2c3e50;
            white-space: nowrap;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #ecf0f1;
            z-index: 10;
        }

        .message-label:hover {
            background: #3498db;
            color: white;
            transform: scale(1.05);
            border-color: #3498db;
        }

        .message-label.field-mapping {
            border: 2px solid #9b59b6;
            background: linear-gradient(135deg, #f8f4fd, #e8d5f2);
            color: #6c3483;
        }

        .message-label.field-mapping:hover {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border-color: #732d91;
        }

        .message-label.code-generator {
            border: 2px solid #e67e22;
            background: linear-gradient(135deg, #fef5e7, #fdeaa7);
            color: #b7950b;
        }

        .message-label.code-generator:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white;
            border-color: #ba4a00;
        }

        .message-label.code-validator {
            border: 2px solid #27ae60;
            background: linear-gradient(135deg, #e8f8f5, #d5f4e6);
            color: #196f3d;
        }

        .message-label.code-validator:hover {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            border-color: #1e8449;
        }

        .message-label.issue-resolver {
            border: 2px solid #e67e22;
            background: linear-gradient(135deg, #fef5e7, #f8c471);
            color: #d68910;
        }

        .message-label.issue-resolver:hover {
            background: linear-gradient(135deg, #e67e22, #f39c12);
            color: white;
            border-color: #d68910;
        }

        /* Notes */
        .note {
            position: absolute;
            background: #f1c40f;
            border: 2px solid #f39c12;
            border-radius: 8px;
            padding: 15px;
            font-size: 0.8em;
            max-width: 280px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 8;
        }

        .note:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 18px rgba(0,0,0,0.2);
        }

        .note.field-mapping {
            background: linear-gradient(135deg, #e8d5f2, #d5b7e8);
            border-color: #9b59b6;
            color: #6c3483;
        }

        .note.code-generator {
            background: linear-gradient(135deg, #fdeaa7, #f7dc6f);
            border-color: #e67e22;
            color: #b7950b;
        }

        .note.code-validator {
            background: linear-gradient(135deg, #d5f4e6, #a9dfbf);
            border-color: #27ae60;
            color: #196f3d;
        }

        .note.issue-resolver {
            background: linear-gradient(135deg, #fef5e7, #f8c471);
            border-color: #e67e22;
            color: #d68910;
        }

        /* Fragments */
        .fragment {
            position: absolute;
            border: 3px solid #9b59b6;
            border-radius: 8px;
            background: rgba(155, 89, 182, 0.08);
            z-index: 1;
        }

        .fragment-label {
            position: absolute;
            top: -18px;
            left: 15px;
            background: #9b59b6;
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            z-index: 2;
        }

        .fragment.generation {
            border-color: #e67e22;
            background: rgba(230, 126, 34, 0.08);
        }

        .fragment.generation .fragment-label {
            background: #e67e22;
        }

        .fragment.validation {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.08);
        }

        .fragment.validation .fragment-label {
            background: #27ae60;
        }

        .fragment.interactive {
            border-color: #e67e22;
            background: rgba(230, 126, 34, 0.12);
            border-style: dashed;
        }

        .fragment.interactive .fragment-label {
            background: #e67e22;
        }

        .fragment.production {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.08);
        }

        .fragment.production .fragment-label {
            background: #3498db;
        }

        /* Controls */
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 200px;
        }

        .control-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .control-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .control-btn.active {
            background: #e74c3c;
        }

        .control-btn.field-mapping {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .control-btn.field-mapping:hover {
            background: linear-gradient(135deg, #8e44ad, #732d91);
        }

        .control-btn.code-generator {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }

        .control-btn.code-generator:hover {
            background: linear-gradient(135deg, #d35400, #ba4a00);
        }

        .control-btn.code-validator {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .control-btn.code-validator:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
        }

        .control-btn.issue-resolver {
            background: linear-gradient(135deg, #e67e22, #f39c12);
        }

        .control-btn.issue-resolver:hover {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        /* Enhanced legend */
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            border: 3px solid #34495e;
            border-radius: 12px;
            padding: 18px;
            font-size: 0.85em;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .legend h4 {
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .legend-item:hover {
            background: #f8f9fa;
            transform: translateX(3px);
        }

        .legend-color {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            border-radius: 4px;
            border: 2px solid #ecf0f1;
        }

        /* Responsive */
        @media (max-width: 1800px) {
            .uml-diagram {
                min-width: 1600px;
                transform: scale(0.9);
                transform-origin: top left;
            }
        }

        @media (max-width: 1400px) {
            .uml-diagram {
                min-width: 1400px;
                transform: scale(0.8);
            }
        }

        @media (max-width: 1200px) {
            .uml-diagram {
                min-width: 1200px;
                transform: scale(0.7);
            }
        }

        @media (max-width: 768px) {
            .uml-diagram {
                min-width: 1000px;
                transform: scale(0.6);
            }
            
            .controls {
                position: relative;
                margin: 20px auto;
                width: fit-content;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîÑ UML Diagram - MDS Formatter Lifecycle</h1>
            <p>Complete system with specialized agents: Field Mapping, Code Generator, Code Validator, and Issue Resolver</p>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="playAnimation()">‚ñ∂Ô∏è Play</button>
            <button class="control-btn" onclick="pauseAnimation()">‚è∏Ô∏è Pause</button>
            <button class="control-btn" onclick="resetAnimation()">üîÑ Reset</button>
            <button class="control-btn" onclick="toggleDetails()">üìã Details</button>
            <button class="control-btn field-mapping" onclick="highlightFieldMapping()">üó∫Ô∏è Field Mapping</button>
            <button class="control-btn code-generator" onclick="highlightCodeGenerator()">‚öôÔ∏è Code Generator</button>
            <button class="control-btn code-validator" onclick="highlightCodeValidator()">‚úÖ Code Validator</button>
            <button class="control-btn issue-resolver" onclick="highlightIssueResolver()">üîÑ Issue Resolver</button>
            <button class="control-btn" onclick="showAgentPrompts()">üìù Prompts</button>
        </div>

        <div class="uml-container">
            <div class="uml-diagram" id="umlDiagram">
                <!-- Actors -->
                <div class="actor" style="left: 50px; top: 20px;">
                    <div class="actor-icon field-mapping" data-tooltip="File analyzer specialized in medical billing field mapping">üó∫Ô∏è</div>
                    <div class="actor-name">FIELD MAPPING<br/><small>(File Analyzer)</small></div>
                </div>

                <div class="actor" style="left: 320px; top: 20px;">
                    <div class="actor-icon code-generator" data-tooltip="C# code generator with host system specific templates">‚öôÔ∏è</div>
                    <div class="actor-name">CODE GENERATOR<br/><small>(C# Generator)</small></div>
                </div>

                <div class="actor" style="left: 590px; top: 20px;">
                    <div class="actor-icon code-validator" data-tooltip="Code validator and automated test generator">‚úÖ</div>
                    <div class="actor-name">CODE VALIDATOR<br/><small>(Validator & Tester)</small></div>
                </div>

                <div class="actor" style="left: 860px; top: 20px;">
                    <div class="actor-icon issue-resolver" data-tooltip="Interactive issue resolution and code regeneration agent">üîÑ</div>
                    <div class="actor-name">ISSUE RESOLVER<br/><small>(Interactive Agent)</small></div>
                </div>

                <div class="actor" style="left: 1130px; top: 20px;">
                    <div class="actor-icon" data-tooltip="Task scheduling and orchestration system">üéØ</div>
                    <div class="actor-name">TaskLauncher</div>
                </div>

                <div class="actor" style="left: 1400px; top: 20px;">
                    <div class="actor-icon" data-tooltip="Console application that executes the complete pipeline">üñ•Ô∏è</div>
                    <div class="actor-name">Console</div>
                </div>

                <div class="actor" style="left: 1670px; top: 20px;">
                    <div class="actor-icon" data-tooltip="Generated and validated formatter (e.g., Pri5230)">üîß</div>
                    <div class="actor-name">Formatter</div>
                </div>

                <!-- Lifelines -->
                <div class="lifeline" style="left: 89px;"></div>
                <div class="lifeline" style="left: 359px;"></div>
                <div class="lifeline" style="left: 629px;"></div>
                <div class="lifeline" style="left: 899px;"></div>
                <div class="lifeline" style="left: 1169px;"></div>
                <div class="lifeline" style="left: 1439px;"></div>
                <div class="lifeline" style="left: 1709px;"></div>

                <!-- PHASE 1: ANALYSIS AND SPECIFICATION -->
                <div class="fragment" style="left: 30px; top: 160px; width: 600px; height: 400px;">
                    <div class="fragment-label">PHASE 1: Analysis and Specification</div>
                </div>

                <!-- Field Mapping Messages -->
                <div class="message field-mapping" id="msg1" style="left: 89px; top: 200px; width: 270px;">
                    <div class="message-label field-mapping">1.1 MDSChecklistFormattingRequirements</div>
                </div>
                <div class="activation field-mapping" style="left: 84px; top: 190px; height: 100px;"></div>

                <div class="message field-mapping" id="msg2" style="left: 89px; top: 260px; width: 270px;">
                    <div class="message-label field-mapping">1.2 Analyze Files data (CSV, Excel, MTRO, etc)</div>
                </div>

                <div class="message field-mapping" id="msg3" style="left: 89px; top: 320px; width: 270px;">
                    <div class="message-label field-mapping">1.3 Validate File Spec (PDF, Excel) vs data</div>
                </div>

                <div class="message field-mapping" id="msg4" style="left: 89px; top: 380px; width: 270px;">
                    <div class="message-label field-mapping">1.4 Generate JSON specification</div>
                </div>

                <!-- Field Mapping Note -->
                <div class="note field-mapping" style="left: 380px; top: 220px;">
                    <strong>Field Mapping Output:</strong><br/>
                    ‚Ä¢ Identified file type<br/>
                    ‚Ä¢ Field status (complete/partial/missing)<br/>
                    ‚Ä¢ Specific File Spec/data evidence<br/>
                    ‚Ä¢ Record types mapping<br/>
                    ‚Ä¢ Technical recommendations
                </div>

                <!-- PHASE 2: CODE GENERATION -->
                <div class="fragment generation" style="left: 300px; top: 580px; width: 350px; height: 320px;">
                    <div class="fragment-label">PHASE 2: C# Code Generation</div>
                </div>

                <!-- Code Generator Messages -->
                <div class="message code-generator" id="msg5" style="left: 359px; top: 620px; width: 270px;">
                    <div class="message-label code-generator">2.1 Select knowledge base</div>
                </div>
                <div class="activation code-generator" style="left: 354px; top: 610px; height: 250px;"></div>

                <div class="message code-generator" id="msg6" style="left: 359px; top: 680px; width: 270px;">
                    <div class="message-label code-generator">2.2 Generate main classes</div>
                </div>

                <div class="message code-generator" id="msg7" style="left: 359px; top: 740px; width: 270px;">
                    <div class="message-label code-generator">2.3 Generate record types</div>
                </div>

                <div class="message code-generator" id="msg8" style="left: 359px; top: 800px; width: 270px;">
                    <div class="message-label code-generator">2.4 Generate complete project</div>
                </div>

                <!-- Code Generator Note -->
                <div class="note code-generator" style="left: 670px; top: 650px;">
                    <strong>Code Generator Output:</strong><br/>
                    ‚Ä¢ Generated formatter code<br/>
                    ‚Ä¢ PriXXXX.cs (main converter)<br/>
                    ‚Ä¢ Specialized handlers<br/>
                    ‚Ä¢ Record Types with FileHelpers<br/>
                    ‚Ä¢ Complete .csproj project<br/>
                    ‚Ä¢ Configured cross-walks
                </div>

                <!-- PHASE 3: VALIDATION AND TESTING -->
                <div class="fragment validation" style="left: 570px; top: 920px; width: 350px; height: 320px;">
                    <div class="fragment-label">PHASE 3: Validation and Testing</div>
                </div>

                <!-- Code Validator Messages -->
                <div class="message code-validator" id="msg9" style="left: 629px; top: 960px; width: 270px;">
                    <div class="message-label code-validator">3.1 Validate compilation</div>
                </div>
                <div class="activation code-validator" style="left: 624px; top: 950px; height: 100px;"></div>

                <div class="message code-validator" id="msg10" style="left: 629px; top: 1020px; width: 270px;">
                    <div class="message-label code-validator">3.2 Validate structure</div>
                </div>

                <div class="message code-validator" id="msg11" style="left: 629px; top: 1080px; width: 270px;">
                    <div class="message-label code-validator">3.3 Generate and execute tests</div>
                </div>

                <!-- Code Validator Note -->
                <div class="note code-validator" style="left: 940px; top: 980px;">
                    <strong>Code Validator Output:</strong><br/>
                    ‚Ä¢ Compilation validation<br/>
                    ‚Ä¢ Structure verification<br/>
                    ‚Ä¢ Complete test suite<br/>
                    ‚Ä¢ Test execution results<br/>
                    ‚Ä¢ Issue analysis report
                </div>

                <!-- PHASE 3.6: INTERACTIVE ISSUE RESOLUTION -->
                <div class="fragment interactive" style="left: 840px; top: 1260px; width: 350px; height: 200px;">
                    <div class="fragment-label">PHASE 3.6: Interactive Issue Resolution</div>
                </div>

                <!-- Issue Resolver Messages -->
                <div class="message issue-resolver" id="msg12" style="left: 899px; top: 1300px; width: 270px;">
                    <div class="message-label issue-resolver">3.6.1 Present test results to user</div>
                </div>
                <div class="activation issue-resolver" style="left: 894px; top: 1290px; height: 150px;"></div>

                <div class="message issue-resolver" id="msg13" style="left: 899px; top: 1360px; width: 270px;">
                    <div class="message-label issue-resolver">3.6.2 Allow custom prompt input</div>
                </div>

                <div class="message issue-resolver" id="msg14" style="left: 899px; top: 1420px; width: 270px;">
                    <div class="message-label issue-resolver">3.6.3 Trigger regeneration if confirmed</div>
                </div>

                <!-- Issue Resolver Note -->
                <div class="note issue-resolver" style="left: 1210px; top: 1320px;">
                    <strong>Issue Resolver Features:</strong><br/>
                    ‚Ä¢ Interactive user interface<br/>
                    ‚Ä¢ Custom prompt capability<br/>
                    ‚Ä¢ Fix confirmation dialog<br/>
                    ‚Ä¢ Iterative improvement cycle<br/>
                    ‚Ä¢ Feedback loop to Phase 2
                </div>

                <!-- PHASE 4: PRODUCTION -->
                <div class="fragment production" style="left: 1110px; top: 1480px; width: 600px; height: 250px;">
                    <div class="fragment-label">PHASE 4: Production and Execution</div>
                </div>

                <!-- Production Messages -->
                <div class="message" id="msg15" style="left: 1169px; top: 1520px; width: 270px;">
                    <div class="message-label">4.1 Execute scheduled task</div>
                </div>
                <div class="activation" style="left: 1164px; top: 1510px; height: 200px;"></div>

                <div class="message" id="msg16" style="left: 1439px; top: 1560px; width: 270px;">
                    <div class="message-label">4.2 Process files</div>
                </div>

                <div class="message" id="msg17" style="left: 1439px; top: 1620px; width: 270px;">
                    <div class="message-label">4.3 Execute validated formatter</div>
                </div>
                <div class="activation" style="left: 1434px; top: 1610px; height: 100px;"></div>

                <!-- Enhanced legend -->
                <div class="legend">
                    <h4>üéØ System Legend</h4>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);"></div>
                        <span>Field Mapping Agent</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #e67e22, #d35400);"></div>
                        <span>Code Generator Agent</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #27ae60, #229954);"></div>
                        <span>Code Validator Agent</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #e67e22, #f39c```html
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #e67e22, #f39c12);"></div>
                        <span>Issue Resolver Agent</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #3498db, #2980b9);"></div>
                        <span>Standard MDS System</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f1c40f;"></div>
                        <span>Notes and Documentation</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(155, 89, 182, 0.3);"></div>
                        <span>Process Phases</span>
                    </div>
                </div>

                <!-- Tooltip -->
                <div class="tooltip" id="tooltip" style="position: absolute; background: #2c3e50; color: white; padding: 15px; border-radius: 8px; font-size: 0.85em; z-index: 1000; box-shadow: 0 8px 25px rgba(0,0,0,0.3); max-width: 350px; line-height: 1.5; display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        let animationStep = 0;
        let animationInterval;
        let isPlaying = false;
        let showDetails = false;

        const messages = [
            'msg1', 'msg2', 'msg3', 'msg4', 'msg5', 'msg6', 'msg7', 'msg8',
            'msg9', 'msg10', 'msg11', 'msg12', 'msg13', 'msg14', 'msg15', 'msg16', 'msg17'
        ];

        const messageDetails = {
            'msg1': {
                title: 'MDSChecklistFormattingRequirements',
                description: 'Field Mapping analyzes MDS formatting requirements against the checklist.',
                technical: 'Input: MDS checklist requirements. Identifies record types, fields, specific evidence.'
            },
            'msg2': {
                title: 'Files Data Analysis',
                description: 'Processing real data files (CSV, Excel, MTRO, etc) for validation.',
                technical: 'Analyzes multi-record formats (01, 10, 20A, 30, 55, 60A, 70, 99), identifies exact fields.'
            },
            'msg3': {
                title: 'File Spec vs Data Validation',
                description: 'Comparison between file specification (PDF, Excel) and actual data content.',
                technical: 'Verifies consistency, identifies discrepancies, evaluates mapping completeness.'
            },
            'msg4': {
                title: 'JSON Specification Generation',
                description: 'Creation of structured specification with evidence and recommendations.',
                technical: 'Output: JSON with fileType, direction, confidence, results[], specific evidence.'
            },
            'msg5': {
                title: 'Knowledge Base Selection',
                description: 'Code Generator selects templates according to detected host system.',
                technical: 'Meditech ‚Üí MeditechExtractV12, Epic ‚Üí EpicConverter, Cerner ‚Üí CernerDelimited'
            },
            'msg6': {
                title: 'Main Classes Generation',
                description: 'Creation of main converter and specialized handlers.',
                technical: 'Generates PriXXXX.cs, DemographicsHandler, TransactionHandler, InventoryHandler'
            },
            'msg7': {
                title: 'Record Types Generation',
                description: 'Creation of FileHelpers classes with appropriate attributes.',
                technical: 'Applies [DelimitedRecord], [FixedLengthRecord], [FieldMapping], MDS converters'
            },
            'msg8': {
                title: 'Complete Project Generation',
                description: 'Creation of project files and configuration.',
                technical: 'Generates .csproj, AssemblyInfo.cs, packages.config, host-specific references'
            },
            'msg9': {
                title: 'Compilation Validation',
                description: 'Code Validator verifies that code compiles correctly.',
                technical: 'Executes dotnet build, identifies compilation errors, verifies using statements'
            },
            'msg10': {
                title: 'Structure Validation',
                description: 'Verification of required CoreUpload framework patterns.',
                technical: 'Validates BaseConverter inheritance, abstract methods, correct base handlers'
            },
            'msg11': {
                title: 'Test Generation and Execution',
                description: 'Creation and execution of complete test suite with unit and integration cases.',
                technical: 'Generates NUnit tests, parsing tests, cross-walks, complete integration, executes and analyzes results'
            },
            'msg12': {
                title: 'Present Test Results to User',
                description: 'Issue Resolver presents test execution results and identified issues to user.',
                technical: 'Interactive interface showing test failures, compilation errors, validation issues with detailed analysis'
            },
            'msg13': {
                title: 'Allow Custom Prompt Input',
                description: 'User can provide custom prompts for specific issue resolution.',
                technical: 'Text input interface for user feedback, custom requirements, specific fix instructions'
            },
            'msg14': {
                title: 'Trigger Regeneration if Confirmed',
                description: 'If user confirms, triggers code regeneration with issue-specific corrections.',
                technical: 'Returns to Phase 2 with user feedback, applies fixes, creates iterative improvement cycle'
            },
            'msg15': {
                title: 'Scheduled Execution',
                description: 'TaskLauncher executes tasks according to configured schedule.',
                technical: 'Inserts READY in protasksstatus, TaskWorker executes Console automatically'
            },
            'msg16': {
                title: 'File Processing',
                description: 'Console executes complete processing pipeline.',
                technical: 'ScanIncomingFiles ‚Üí BuildProcessFiles ‚Üí PopulateUplprocess'
            },
            'msg17': {
                title: 'Validated Formatter Execution',
                description: 'Generated and validated formatter processes files with higher precision.',
                technical: 'QualifyFiles ‚Üí LoadFiles ‚Üí ProcessRecords with audited mappings'
            }
        };

        const agentPrompts = {
            fieldMapping: {
                title: "FIELD MAPPING - File Analyzer",
                checklistPrompt: `You are a file analyzer specializing in medical billing data formats (Meditech, Epic, Cerner, etc.).

Analyze the MDS checklist formatting requirements and validate them against the provided data sources.

**Your Task:**
1. Read and understand the MDS checklist requirements structure
2. Determine the file type based on the content:
   - Placements (patient/account placement data with demographics)
   - Transactions (payment/financial transactions)
   - Recalls (recall/follow-up data)
   - Notes (notes or comments)
   - Inventory (balance updates)

3. Determine direction: Incoming or Outgoing

4. For each checklist item, evaluate:
   - "complete" if there is an explicit, unequivocal field
   - "partial" if it is approximate or unclear
   - "missing" if not found

5. Cite evidence from the document (e.g., "Record 30 - Adm/Svc Date")

Respond with ONLY a JSON object (no markdown, no explanation)`,

                dataPrompt: `You are a data file analyzer specializing in medical billing data formats (Meditech, Epic, Cerner, etc.).

Analyze the provided data files (CSV, Excel, MTRO, etc) and validate against the checklist requirements.

The data files may have multi-record formats where different record types are identified by indicators (like "01", "10", "20A", "30", etc.) at the beginning of each line.

Common record types:
- Record Type 01 = File Header
- Record Type 10 = Patient Demographics
- Record Type 20A = Guarantor Demographics
- Record Type 30 = Visit/Account Info
- Record Type 55 = Billing Information
- Record Type 60A = Insurance
- Record Type 70 = Transactions
- Record Type 99 = File Trailer

**Your Task:**
1. Determine the file type: Placements, Transactions, Recalls, Notes, or Inventory
2. For each checklist item, find if it exists in the data
3. Specify the EXACT record type and field where each item was found
4. Evaluate status: complete (found), partial (approximate), missing (not found)`
            },

            codeGenerator: {
                title: "CODE GENERATOR - C# Generator",
                prompt: `You are a specialized agent for generating MDS collection upload formatter code. You generate production-ready C# code by leveraging existing templates and knowledge bases for the detected host system.

## Input Requirements
You receive a JSON specification from the field-mapping agent containing:
- sourceSystem.detected: The host system (Meditech, Epic, Cerner, or Unknown)
- sourceSystem.version: Version if applicable (V11, V12, etc.)
- fileInfo: Format details (delimiter, encoding, headers)
- recordTypes: Field definitions with mappings
- crossWalks: Transaction codes and financial classes

## Knowledge Base Selection
Based on sourceSystem.detected, read the corresponding knowledge base:

| Host System | Knowledge Base Directory | Template Directory |
|-------------|-------------------------|-------------------|
| **Meditech** | ./context/Meditech/ | ./context/Templates/Meditech/MeditechExtractV12/ |
| **Epic** | ./context/Epic/ | ./context/Templates/Epic/EpicConverter/ |
| **Cerner** | ./context/Cerner/ | ./context/Templates/Cerner/CernerDelimited/ |
| **Unknown** | ./context/CoreUpload/ | ./context/Templates/SimpleConverter/ |

## Generate Artifacts
1. **PriXXXX.cs** - Main converter class
2. **InventoryRecordType.cs** - FileHelpers record class
3. **PriXXXX.csproj** - Project file
4. **Properties/AssemblyInfo.cs** - Assembly metadata
5. **packages.config** - NuGet packages

## Output
The generated formatter code ready for compilation and testing.`
            },

            codeValidator: {
                title: "CODE VALIDATOR - Validator & Tester",
                prompt: `You are a specialized agent for validating MDS collection upload formatter code and creating automated tests.

## Validation Process

### 1. Syntax and Compilation Validation
Check that generated code compiles:
\`\`\`bash
dotnet build src/PriXXXX/PriXXXX.csproj --no-restore
\`\`\`

### 2. Structure Validation
Verify formatter implements required patterns:
- Main converter inherits from BaseConverter
- All handlers inherit from BaseConversionClass or DelimitedHandler
- QualifyFile() handles all expected InputTypes
- GetConverter() returns handler for each InputType

### 3. Database Schema Validation
Verify field mappings against MDS Cupload schema:
- uplmaster (60 fields) - Required fields validation
- upltrans (18 fields) - Transaction mappings
- uplinsurance (42 fields) - Insurance mappings

### 4. Test Generation and Execution
Generate and execute NUnit test cases:
- Unit tests for record parsing
- Integration tests for file processing
- Cross-walk validation tests
- Error handling tests

### 5. Validation Report
Generate detailed report with:
- Compilation status
- Structure validation results
- Database mapping verification
- Test execution results
- Issue analysis and recommendations`
            },

            issueResolver: {
                title: "ISSUE RESOLVER - Interactive Agent",
                prompt: `You are an interactive agent specialized in issue resolution and iterative code improvement for MDS formatter development.

## Your Role
You serve as the bridge between automated validation results and user-driven improvements, creating a feedback loop for continuous enhancement.

## Process Flow

### 1. Present Test Results
- Display comprehensive test execution results
- Highlight failing tests with detailed error analysis
- Show compilation errors and warnings
- Present validation issues in user-friendly format

### 2. Interactive User Interface
- Provide text input for custom prompts and requirements
- Allow users to specify particular areas of concern
- Enable detailed feedback on specific issues
- Support technical discussions about implementation approaches

### 3. Issue Resolution Confirmation
Ask user: "Would you like to fix the identified issues and regenerate the code?"
- Present clear options: Yes/No/Customize
- If "Customize": Allow detailed prompt input
- If "Yes": Use standard issue resolution approach
- If "No": End process with current state

### 4. Feedback Integration and Regeneration
When user confirms fixes:
- Incorporate user feedback into regeneration process
- Apply issue-specific corrections and improvements
- Trigger Phase 2 (Code Generation) with enhanced requirements
- Include user custom prompts in generation context
- Apply fixes for compilation errors, test failures, validation issues

### 5. Iterative Improvement Cycle
- Return to Phase 3 (Validation and Testing) for re-validation
- Continue cycle until all tests pass or user is satisfied
- Maintain history of improvements and user feedback
- Track resolution effectiveness for future improvements

## Output Artifacts
- User interaction logs
- Issue resolution history
- Feedback integration reports
- Iterative improvement tracking
- Final resolution summary`
            }
        };

        function playAnimation() {
            if (isPlaying) return;
            isPlaying = true;
            
            animationInterval = setInterval(() => {
                if (animationStep < messages.length) {
                    animateMessage(messages[animationStep]);
                    animationStep++;
                } else {
                    pauseAnimation();
                    animationStep = 0;
                }
            }, 2500);

            document.querySelector('.control-btn').classList.add('active');
        }

        function pauseAnimation() {
            isPlaying = false;
            clearInterval(animationInterval);
            document.querySelector('.control-btn').classList.remove('active');
        }

        function resetAnimation() {
            pauseAnimation();
            animationStep = 0;
            
            // Reset all animations
            messages.forEach(msgId => {
                const msg = document.getElementById(msgId);
                if (msg) {
                    msg.classList.remove('animate-message');
                    msg.style.opacity = '0.3';
                }
            });
        }

        function animateMessage(messageId) {
            const message = document.getElementById(messageId);
            if (message) {
                message.style.opacity = '1';
                message.style.animation = 'messageFlow 1.5s ease-in-out';
                
                // Animate related actor
                const actorIndex = getActorIndexForMessage(messageId);
                const actors = document.querySelectorAll('.actor-icon');
                if (actors[actorIndex]) {
                    actors[actorIndex].style.animation = 'pulse 2s infinite, agentGlow 3s infinite';
                    setTimeout(() => {
                        actors[actorIndex].style.animation = '';
                    }, 2000);
                }
            }
        }

        function getActorIndexForMessage(messageId) {
            const messageToActor = {
                'msg1': 0, 'msg2': 0, 'msg3': 0, 'msg4': 0,  // Field Mapping
                'msg5': 1, 'msg6': 1, 'msg7': 1, 'msg8': 1,  // Code Generator
                'msg9': 2, 'msg10': 2, 'msg11': 2,           // Code Validator
                'msg12': 3, 'msg13': 3, 'msg14': 3,          // Issue Resolver
                'msg15': 4, 'msg16': 5, 'msg17': 6           // Production
            };
            return messageToActor[messageId] || 0;
        }

        function toggleDetails() {
            showDetails = !showDetails;
            const btn = document.querySelectorAll('.control-btn')[3];
            btn.textContent = showDetails ? 'üìã Hide' : 'üìã Details';
            btn.classList.toggle('active', showDetails);
        }

        function highlightFieldMapping() {
            highlightAgent(0, 'field-mapping');
        }

        function highlightCodeGenerator() {
            highlightAgent(1, 'code-generator');
        }

        function highlightCodeValidator() {
            highlightAgent(2, 'code-validator');
        }

        function highlightIssueResolver() {
            highlightAgent(3, 'issue-resolver');
        }

        function highlightAgent(agentIndex, className) {
            // Reset previous highlights
            document.querySelectorAll('.message, .actor-icon, .activation, .note, .fragment').forEach(el => {
                el.style.filter = 'none';
                el.style.transform = el.style.transform.replace(/scale\([^)]*\)/g, '');
            });

            // Highlight specific agent elements
            const elements = document.querySelectorAll(`.${className}`);
            elements.forEach(el => {
                if (el) {
                    el.style.filter = 'drop-shadow(0 0 20px currentColor)';
                    const currentTransform = el.style.transform || '';
                    el.style.transform = currentTransform + ' scale(1.05)';
                }
            });

            setTimeout(() => {
                elements.forEach(el => {
                    if (el) {
                        el.style.filter = 'none';
                        el.style.transform = el.style.transform.replace(/scale\([^)]*\)/g, '');
                    }
                });
            }, 5000);
        }

        function showAgentPrompts() {
            const promptsHtml = `
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); max-width: 1000px; max-height: 80vh; overflow-y: auto;">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">üìù MDS Agent Prompts</h2>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #9b59b6; margin-bottom: 15px;">üó∫Ô∏è ${agentPrompts.fieldMapping.title}</h3>
                        <div style="background: #f8f4fd; padding: 15px; border-radius: 8px; border-left: 4px solid #9b59b6; margin-bottom: 15px;">
                            <strong>Checklist Analysis:</strong>
                        </div>
                        <pre style="background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; font-size: 0.75em; overflow-x: auto; white-space: pre-wrap;">${agentPrompts.fieldMapping.checklistPrompt}</pre>
                        
                        <div style="background: #f8f4fd; padding: 15px; border-radius: 8px; border-left: 4px solid #9b59b6; margin: 15px 0;">
                            <strong>Data Analysis:</strong>
                        </div>
                        <pre style="background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; font-size: 0.75em; overflow-x: auto; white-space: pre-wrap;">${agentPrompts.fieldMapping.dataPrompt}</pre>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #e67e22; margin-bottom: 15px;">‚öôÔ∏è ${agentPrompts.codeGenerator.title}</h3>
                        <pre style="background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; font-size: 0.75em; overflow-x: auto; white-space: pre-wrap;">${agentPrompts.codeGenerator.prompt}</pre>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #27ae60; margin-bottom: 15px;">‚úÖ ${agentPrompts.codeValidator.title}</h3>
                        <pre style="background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; font-size: 0.75em; overflow-x: auto; white-space: pre-wrap;">${agentPrompts.codeValidator.prompt}</pre>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #e67e22; margin-bottom: 15px;">üîÑ ${agentPrompts.issueResolver.title}</h3>
                        <pre style="background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; font-size: 0.75em; overflow-x: auto; white-space: pre-wrap;">${agentPrompts.issueResolver.prompt}</pre>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()"
                            style="background: #3498db; color: white; border: none; padding: 12px 24px;
                                   border-radius: 8px; cursor: pointer; margin-top: 20px; float: right; font-weight: bold;">
                        Close
                    </button>
                </div>
            `;

            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 2000; display: flex;
                align-items: center; justify-content: center; padding: 20px;
                box-sizing: border-box;
            `;
            overlay.innerHTML = promptsHtml;
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
            document.body.appendChild(overlay);
        }

        // Tooltips
        function showTooltip(element, content) {
            const tooltip = document.getElementById('tooltip');
            const rect = element.getBoundingClientRect();
            const container = document.querySelector('.uml-container');
            const containerRect = container.getBoundingClientRect();
            
            tooltip.innerHTML = content;
            tooltip.style.display = 'block';
            tooltip.style.left = (rect.left - containerRect.left + rect.width / 2 - 175) + 'px';
            tooltip.style.top = (rect.bottom - containerRect.top + 15) + 'px';
        }

        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize state
            resetAnimation();

            // Tooltips for actors
            document.querySelectorAll('.actor-icon').forEach(actor => {
                actor.addEventListener('mouseenter', (e) => {
                    const tooltip = e.target.getAttribute('data-tooltip');
                    if (tooltip) {
                        showTooltip(e.target, tooltip);
                    }
                });
                actor.addEventListener('mouseleave', hideTooltip);
            });

            // Tooltips for messages
            document.querySelectorAll('.message-label').forEach(label => {
                label.addEventListener('mouseenter', (e) => {
                    if (showDetails) {
                        const messageId = e.target.closest('.message').id;
                        const detail = messageDetails[messageId];
                        if (detail) {
                            const content = `
                                <strong>${detail.title}</strong><br/>
                                ${detail.description}<br/><br/>
                                <em>Technical:</em> ${detail.technical}
                            `;
                            showTooltip(e.target, content);
                        }
                    }
                });
                label.addEventListener('mouseleave', hideTooltip);
            });

            // Auto-play initial after 3 seconds
            setTimeout(() => {
                playAnimation();
            }, 3000);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    if (isPlaying) pauseAnimation();
                    else playAnimation();
                    break;
                case 'r':
                    resetAnimation();
                    break;
                case 'd':
                    toggleDetails();
                    break;
                case '1':
                    highlightFieldMapping();
                    break;
                case '2':
                    highlightCodeGenerator();
                    break;
                case '3':
                    highlightCodeValidator();
                    break;
                case '4':
                    highlightIssueResolver();
                    break;
                case 'p':
                    showAgentPrompts();
                    break;
            }
        });

        // CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.15); }
                100% { transform: scale(1); }
            }

            @keyframes messageFlow {
                0% { width: 0; opacity: 0; }
                100% { width: 100%; opacity: 1; }
            }

            @keyframes agentGlow {
                0% { box-shadow: 0 0 5px currentColor; }
                50% { box-shadow: 0 0 25px currentColor, 0 0 35px currentColor; }
                100% { box-shadow: 0 0 5px currentColor; }
            }
        `;
        document.head.appendChild(style);

        console.log('üîÑ Complete UML Diagram of MDS Formatter Lifecycle loaded');
        console.log('‚å®Ô∏è Shortcuts: Space=Play/Pause, R=Reset, D=Details, 1-4=Highlight Agents, P=Prompts');
        console.log('ü§ñ Agents: Field Mapping, Code Generator, Code Validator, Issue Resolver');
        console.log('üìä Phases: Analysis ‚Üí Generation ‚Üí Validation ‚Üí Interactive ‚Üí Production');
    </script>
</body>
</html>
