<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDS Formatter Lifecycle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .phase {
            margin: 20px 0;
            border: 2px solid #3498db;
            border-radius: 8px;
            overflow: hidden;
        }
        .phase-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px;
            font-weight: bold;
            font-size: 18px;
        }
        .phase-content {
            padding: 20px;
            background: #f8f9fa;
        }
        .step {
            background: white;
            margin: 10px 0;
            padding: 15px;
            border-left: 4px solid #e74c3c;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .step.interactive {
            border-left: 4px solid #e67e22;
            background: linear-gradient(135deg, #fef5e7, #fff);
        }
        .step-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .step-description {
            color: #555;
            margin-bottom: 10px;
        }
        .agent-participation {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #4caf50;
        }
        .agent-name {
            font-weight: bold;
            color: #2e7d32;
        }
        .agent-task {
            color: #388e3c;
            font-style: italic;
        }
        .flow-arrow {
            text-align: center;
            font-size: 24px;
            color: #3498db;
            margin: 10px 0;
        }
        .feedback-loop {
            text-align: center;
            font-size: 20px;
            color: #e67e22;
            margin: 15px 0;
            background: #fef5e7;
            padding: 10px;
            border-radius: 8px;
            border: 2px dashed #e67e22;
        }
        .legend {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        .legend h3 {
            margin-top: 0;
            color: #856404;
        }
        .code-sample {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        .interactive-note {
            background: #fef5e7;
            border: 2px solid #e67e22;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .interactive-note h4 {
            color: #d68910;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MDS Collection Upload Formatter Lifecycle</h1>
        
        <div class="legend">
            <h3>Participating Agents</h3>
            <p><strong>File Analyzer:</strong> Analyzes MDS collection upload data files and generates structured JSON specifications for formatter code generation</p>
            <p><strong>Code Generator:</strong> Generates C# formatter code based on JSON specifications using host system specific templates</p>
            <p><strong>Code Validator:</strong> Validates generated code against CoreUpload framework and generates test cases</p>
        </div>

        <!-- PHASE 1: ANALYSIS AND SPECIFICATION -->
        <div class="phase">
            <div class="phase-header">
                PHASE 1: DATA ANALYSIS AND SPECIFICATION
            </div>
            <div class="phase-content">
                
                <div class="step">
                    <div class="step-title">1.1 Data File Analysis</div>
                    <div class="step-description">
                        Analysis of actual data files to validate structure against checklist requirements.
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">üìä FILE ANALYZER</div>
                        <div class="agent-task">
                            ‚Ä¢ Analyzes sample files to prepare MDS formatter generation<br>
                            ‚Ä¢ Detects format (delimited, fixed-width, Excel, multi-record)<br>
                            ‚Ä¢ Identifies structure (headers, trailers, encoding)<br>
                            ‚Ä¢ Maps fields to MDS target tables<br>
                            ‚Ä¢ Identifies required converters (dates, decimals, phones)
                        </div>
                    </div>
                    <div class="code-sample">
Output: JSON with metadata, fileInfo, sourceSystem, recordTypes[], crossWalks, auditFields
                    </div>
                </div>

            </div>
        </div>

        <div class="flow-arrow">‚¨áÔ∏è</div>

        <!-- PHASE 2: CODE GENERATION -->
        <div class="phase">
            <div class="phase-header">
                PHASE 2: C# CODE GENERATION
            </div>
            <div class="phase-content">

                <div class="step">
                    <div class="step-title">2.1 Knowledge Base Selection</div>
                    <div class="step-description">
                        Selection of appropriate base system (Meditech, Epic, Cerner) and reading corresponding templates.
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">‚öôÔ∏è CODE GENERATOR</div>
                        <div class="agent-task">
                            ‚Ä¢ Reads JSON specification from file-analyzer<br>
                            ‚Ä¢ Selects knowledge base according to sourceSystem.detected<br>
                            ‚Ä¢ Reads templates from corresponding directory<br>
                            ‚Ä¢ Understands host system specific patterns
                        </div>
                    </div>
                    <div class="code-sample">
Meditech ‚Üí ./context/Templates/Meditech/MeditechExtractV12/
Epic ‚Üí ./context/Templates/Epic/EpicConverter/
Cerner ‚Üí ./context/Templates/Cerner/CernerDelimited/
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">2.2 Main Classes Generation</div>
                    <div class="step-description">
                        Generation of main converter and specific handlers based on templates.
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">‚öôÔ∏è CODE GENERATOR</div>
                        <div class="agent-task">
                            ‚Ä¢ Generates PriXXXX.cs (main converter class)<br>
                            ‚Ä¢ Implements IAccountCache, IConverterSettings interfaces<br>
                            ‚Ä¢ Creates DemographicsHandler inheriting from host-specific base<br>
                            ‚Ä¢ Includes cross-walks for transaction codes and financial classes<br>
                            ‚Ä¢ Implements QualifyFile() and GetConverter()
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">2.3 Record Types Generation</div>
                    <div class="step-description">
                        Creation of FileHelpers classes for file parsing with appropriate attributes.
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">‚öôÔ∏è CODE GENERATOR</div>
                        <div class="agent-task">
                            ‚Ä¢ Generates InventoryRecordType.cs with FileHelpers attributes<br>
                            ‚Ä¢ Applies [DelimitedRecord] or [FixedLengthRecord]<br>
                            ‚Ä¢ Includes [FieldQuoted], [FieldTrim] according to specification<br>
                            ‚Ä¢ Uses MDSDecimalConverter for balance fields
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">2.4 Project Files Generation</div>
                    <div class="step-description">
                        Creation of project configuration files (.csproj, packages.config, AssemblyInfo.cs).
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">‚öôÔ∏è CODE GENERATOR</div>
                        <div class="agent-task">
                            ‚Ä¢ Generates PriXXXX.csproj with .NET Framework 4.7.2<br>
                            ‚Ä¢ Includes references: CoreUpload, MDSCommon.NET, FileHelpers<br>
                            ‚Ä¢ Adds host system specific reference<br>
                            ‚Ä¢ Creates Properties/AssemblyInfo.cs and packages.config
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="flow-arrow">‚¨áÔ∏è</div>

        <!-- PHASE 3: VALIDATION AND TESTING -->
        <div class="phase">
            <div class="phase-header">
                PHASE 3: VALIDATION AND TEST GENERATION
            </div>
            <div class="phase-content">

                <div class="step">
                    <div class="step-title">3.1 Compilation Validation</div>
                    <div class="step-description">
                        Verification that generated code compiles correctly against CoreUpload framework.
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">‚úÖ CODE VALIDATOR</div>
                        <div class="agent-task">
                            ‚Ä¢ Executes dotnet build or msbuild on project<br>
                            ‚Ä¢ Identifies common compilation errors<br>
                            ‚Ä¢ Verifies missing using statements<br>
                            ‚Ä¢ Validates correct usage of FileHelpers attributes
                        </div>
                    </div>
                    <div class="code-sample">
dotnet build src/PriXXXX/PriXXXX.csproj --no-restore
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">3.2 Structure Validation</div>
                    <div class="step-description">
                        Verification that formatter implements required framework patterns.
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">‚úÖ CODE VALIDATOR</div>
                        <div class="agent-task">
                            ‚Ä¢ Verifies BaseConverter inheritance<br>
                            ‚Ä¢ Validates implementation of required abstract methods<br>
                            ‚Ä¢ Confirms handlers inherit from correct base classes<br>
                            ‚Ä¢ Verifies [FieldMapping] attributes in record types
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">3.3 Database Schema Validation</div>
                    <div class="step-description">
                        Verification that field mappings match MDS Cupload database schema.
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">‚úÖ CODE VALIDATOR</div>
                        <div class="agent-task">
                            ‚Ä¢ Validates mappings against uplmaster schema (60 fields)<br>
                            ‚Ä¢ Verifies required fields (accountnumber, membercode, loadexe, etc.)<br>
                            ‚Ä¢ Confirms type compatibility (string, int, decimal)<br>
                            ‚Ä¢ Validates maximum field lengths
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">3.4 Cross-Walks Validation</div>
                    <div class="step-description">
                        Verification that all transaction codes and financial classes are mapped.
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">‚úÖ CODE VALIDATOR</div>
                        <div class="agent-task">
                            ‚Ä¢ Verifies all sample codes are mapped<br>
                            ‚Ä¢ Confirms default handling for unknown codes<br>
                            ‚Ä¢ Validates completeness of insurance types cross-walks<br>
                            ‚Ä¢ Verifies usage of host-specific types (e.g., Meditech.TransactionCode)
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">3.5 Test Generation and Execution</div>
                    <div class="step-description">
                        Creation and execution of NUnit test cases to validate parsing and data mapping, with comprehensive result analysis.
                    </div>
                    <div class="agent-participation">
                        <div class="agent-name">‚úÖ CODE VALIDATOR</div>
                        <div class="agent-task">
                            ‚Ä¢ Generates tests for valid record parsing<br>
                            ‚Ä¢ Creates tests for nullable field handling<br>
                            ‚Ä¢ Includes tests for invalid dates and conversions<br>
                            ‚Ä¢ Generates tests for file classification (QualifyFile)<br>
                            ‚Ä¢ Creates integration tests for cross-walks<br>
                            ‚Ä¢ <strong>Executes complete test suite</strong><br>
                            ‚Ä¢ <strong>Analyzes test results and identifies failures</strong><br>
                            ‚Ä¢ <strong>Generates detailed validation report with issues</strong>
                        </div>
                    </div>
                    <div class="code-sample">
Output: Test suite + execution results + issue analysis report + validation-report.md
                    </div>
                </div>

            </div>
        </div>

        <div class="flow-arrow">‚¨áÔ∏è</div>

        <!-- PHASE 4: DELIVERY AND DEPLOYMENT -->
        <div class="phase">
            <div class="phase-header">
                PHASE 4: DELIVERY AND DEPLOYMENT
            </div>
            <div class="phase-content">

                <div class="step">
                    <div class="step-title">4.1 Final Packaging</div>
                    <div class="step-description">
                        Preparation of all generated artifacts for deployment.
                    </div>
                    <div class="step-description">
                        <strong>Generated Artifacts:</strong><br>
                        ‚Ä¢ PriXXXX.cs - Main converter with handlers<br>
                        ‚Ä¢ InventoryRecordType.cs - FileHelpers classes<br>
                        ‚Ä¢ PriXXXX.csproj - Project file<br>
                        ‚Ä¢ Properties/AssemblyInfo.cs - Assembly metadata<br>
                        ‚Ä¢ packages.config - NuGet packages<br>
                        ‚Ä¢ Tests/ - Unit test cases<br>
                        ‚Ä¢ reports/validation-report.md - Validation report
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">4.2 Implementation Documentation</div>
                    <div class="step-description">
                        Generation of documentation for implementation team.
                    </div>
                    <div class="step-description">
                        <strong>Includes:</strong><br>
                        ‚Ä¢ Database profile configuration<br>
                        ‚Ä¢ Expected file patterns<br>
                        ‚Ä¢ Configured cross-walks<br>
                        ‚Ä¢ Mapped fields and applied conversions<br>
                        ‚Ä¢ Testing and deployment instructions
                    </div>
                </div>

            </div>
        </div>

        <div class="legend">
            <h3>Data Flow Between Agents</h3>
            <p><strong>File Analyzer ‚Üí Code Generator:</strong> Detailed JSON specification with file structure and mappings</p>
            <p><strong>Code Generator ‚Üí Code Validator:</strong> Generated C# code for validation and testing</p>
            <p><strong>Code Validator ‚Üí Delivery:</strong> Validated code, tests, and quality report</p>
        </div>

        <div class="interactive-note">
            <h4>üîÑ Key Process Improvements:</h4>
            <ul>
                <li><strong>Consolidated Testing:</strong> Combined test generation and execution in step 3.5 for efficiency</li>
                <li><strong>Iterative Enhancement:</strong> Continuous improvement until all tests pass and user requirements are met</li>
                <li><strong>User-Centric Approach:</strong> Maintains quality while allowing custom modifications and specific fixes</li>
            </ul>
        </div>

    </div>
</body>
</html>
